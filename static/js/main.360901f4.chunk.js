(this.webpackJsonpnook=this.webpackJsonpnook||[]).push([[0],{24:function(e,t,a){},26:function(e,t,a){},27:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){},30:function(e,t,a){},31:function(e,t,a){},32:function(e,t,a){},34:function(e,t,a){"use strict";a.r(t);var n,r,c=a(0),i=a.n(c),s=a(10),o=a.n(s),l=a(5),u=a(2);!function(e){e.Pregame="pregame",e.Preround="preround",e.Postgame="postgame",e.Wait="wait",e.Play="play",e.Discard="discard",e.Think="think"}(n||(n={})),function(e){e.Deck="deck",e.Discard="discard",e.Center="center",e.Hand="hand",e.Win="win"}(r||(r={}));var d=function(e){switch(e){case r.Center:return 0;case r.Discard:return 1;case r.Deck:return 2;case r.Hand:return 3;case r.Win:return 4}},p=a(3),h=a(18),y=a(12),f=a(14),m=function(e,t){return(e.color===t.color?1:0)+(e.wallpaper===t.wallpaper?1:0)+(e.decoration===t.decoration?1:0)},j=function(e){return"[".concat(e.color,",").concat(e.wallpaper,",").concat(e.decoration," (").concat(e.id,")]")},b=a(7),g=a(8),O=a(16),w=a(17),x=a(19),k=function(e){Object(O.a)(a,e);var t=Object(w.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"shuffle",value:function(){var e=new a;return e.push.apply(e,Object(f.a)(this.map((function(e){return{value:e,sort:Math.random()}})).sort((function(e,t){return e.sort-t.sort})).map((function(e){return e.value})))),e}}],[{key:"create",value:function(){for(var e=new a,t=["blue","grey","red"],n=["flower","stripes","chevron"],c=["clock","picture","plant"],i=0;i<2;i++)t.forEach((function(t){n.forEach((function(a){c.forEach((function(n){e.push({id:e.length,color:t,wallpaper:a,decoration:n,location:r.Deck,visible:!1,pos:{x:0,y:0},owner:null,animating:!1})}))}))}));return e.shuffle()}}]),a}(Object(x.a)(Array)),v=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"isHuman",value:function(){return!0}},{key:"cancelThoughts",value:function(){}},{key:"onCardPlayed",value:function(e,t,a){}},{key:"onDiscardNeeded",value:function(e,t,a){}}]),e}(),D=function(){function e(){Object(b.a)(this,e),this.timeout=void 0,this.timeout=null}return Object(g.a)(e,[{key:"isHuman",value:function(){return!1}},{key:"cancelThoughts",value:function(){null!==this.timeout&&clearTimeout(this.timeout)}},{key:"onCardPlayed",value:function(e,t,a){this.cancelThoughts(),t.paused||[n.Wait,n.Discard,n.Pregame,n.Preround].includes(t.turn.phase)||(this.timeout=setTimeout((function(){for(var n=E(t),r=z(t,e.seat),c=0,i=-1,s=0;s<r.length;s++){var o=m(r[s],n);o>c&&(c=o,i=r[s].id)}-1===i||t.turn.player!==e.seat&&3!==c?t.turn.player===e.seat&&a({type:C.Draw,payload:{player:e.seat}}):a({type:C.PlayCard,payload:{id:i,player:e.seat}})}),1e3*z(t,e.seat).length),t.turn.player===e.seat&&t.turn.phase!==n.Think&&a({type:C.Think,payload:{player:e.seat}}))}},{key:"onDiscardNeeded",value:function(e,t,a){var n=z(t,e.seat);e.toDiscard>0&&n.length>0&&a({type:C.DiscardCard,payload:{id:n[0].id,player:e.seat}})}}]),e}();function P(e){return{deck:{x:e.width/3-225,y:e.height/3+50},center:{x:e.width/2-100,y:e.height/3+25},discard:{x:e.width/3*2,y:e.height/3+50},win:{x:-1e3,y:-1e3},players:[{x:e.width/2-25,y:e.height-300},{x:e.width/3-e.width/5,y:10},{x:e.width/3*2-e.width/5,y:10},{x:e.width/3*3-e.width/5,y:10},{x:e.width/3*4-e.width/5,y:10}]}}var C,S=function(){var e=Object(c.useState)({width:0,height:0}),t=Object(p.a)(e,2),a=t[0],n=t[1],r=Object(c.useState)(P(a)),i=Object(p.a)(r,2),s=i[0],o=i[1];return Object(c.useEffect)((function(){function e(){n({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),Object(c.useEffect)((function(){o(P(a))}),[a]),s},G={cards:new k,center:-1,previousCenter:-1,players:[],turn:{player:0,phase:n.Pregame},paused:!1,positions:P({width:window.innerWidth,height:window.innerHeight})};function R(e,t){switch(t.type){case C.LoadGame:e.cards=Object(y.a)(k,Object(f.a)(t.payload.cards)),e.center=t.payload.center,e.previousCenter=t.payload.previousCenter,e.players=t.payload.players,e.turn=t.payload.turn;break;case C.StartGame:for(var a=new Array,c=0;c<t.payload.numHumans;c++)a.push({seat:c,name:"You",strategy:new v,toDiscard:0});for(var i=0;i<t.payload.numBots;i++)a.push({seat:i+t.payload.numHumans,name:"Bot ".concat(i+1),strategy:new D,toDiscard:0});e.cards=k.create(),e.players=a,e.turn={player:Math.floor(Math.random()*a.length),phase:n.Preround};break;case C.PauseGame:e.paused=!0;break;case C.ResumeGame:e.paused=!1;break;case C.Resize:e.positions=t.payload,e.cards.map((function(t){switch(t.location){case r.Center:t.pos=e.positions.center;break;case r.Deck:t.pos=e.positions.deck;break;case r.Discard:t.pos=e.positions.discard;break;case r.Hand:null!==t.owner&&(t.pos=e.positions.players[t.owner])}return t}));break;case C.Deal:var s=9-e.players.length+3;N(e,e.cards.find((function(e){return e.location===r.Deck})),!1);for(var o=0;o<e.players.length;o++)for(var u=0;u<s+T(e,o);u++)F(e,o);e.turn.phase=n.Wait;break;case C.StartRound:e.cards.filter((function(t){return t.id===e.center}))[0].visible=!0,e.turn.phase=n.Play;break;case C.PlayCard:var d=W(e,t.payload.id),p=W(e,e.center);if(d&&p){var h=m(p,d);console.log("".concat(e.players[t.payload.player].name," played ").concat(j(d),". It has ").concat(h," matches on ").concat(j(p))),e.turn.player===t.payload.player&&h>0?(N(e,d,!0),h-1>0?(e.turn.phase=n.Discard,e.players[e.turn.player].toDiscard=h-1):(e.turn.player++,e.turn.player>=e.players.length&&(e.turn.player=0),e.turn.phase=n.Play)):e.turn.player!==t.payload.player&&3===h?(Object(l.b)("Perfect Match!",{toastId:"perfect-match"}),N(e,d,!0)):0===t.payload.player&&l.b.error("That card has no matches!",{toastId:"rejected"})}break;case C.DiscardCard:var b=W(e,t.payload.id);b&&(!function(e,t){t.location=r.Discard,t.pos=e.positions.discard,t.visible=!1,t.owner=null,t.animating=!0}(e,b),e.players[e.turn.player].toDiscard--,console.log("".concat(e.players[t.payload.player].name," discarded a card.")),e.players[e.turn.player].toDiscard<=0&&(e.turn.player++,e.turn.player>=e.players.length&&(e.turn.player=0),e.turn.phase=n.Play));break;case C.Think:e.turn.player===t.payload.player&&(e.turn.phase=n.Think);break;case C.Draw:0===e.cards.filter((function(e){return e.location===r.Deck})).length&&e.cards.map((function(t){return t.location===r.Discard&&(t.location=r.Deck,t.pos=e.positions.deck,t.animating=!0),t})),e.turn.player===t.payload.player&&F(e,e.turn.player);break;case C.WinRound:Object(l.b)("".concat(e.players[t.payload.player].name," won the round!"),{toastId:"win-round"}),H(e,e.cards.find((function(e){return e.location!==r.Win})),t.payload.player),function(e,t){e.cards.map((function(t){return t.location!==r.Win&&(t.location=r.Deck,t.pos=e.positions.deck,t.visible=!1,t.owner=null,t.animating=!0),t})),e.cards=e.cards.shuffle(),e.turn={player:t+1,phase:n.Preround},e.turn.player>=e.players.length&&(e.turn.player=0);e.players.forEach((function(e){return e.toDiscard=0}))}(e,t.payload.player);break;case C.WinGame:H(e,e.cards.find((function(e){return e.location!==r.Win})),t.payload.player),e.turn.phase=n.Postgame;break;case C.FinishAnimation:var g=W(e,t.payload.id);g&&(g.animating=!1);break;default:throw new Error("Unknown action ".concat(JSON.stringify(t)))}}function W(e,t){return e.cards.find((function(e){return e.id===t}))}function N(e,t,a){e.previousCenter=e.center,t.location=r.Center,t.pos=e.positions.center,t.visible=a,t.owner=null,t.animating=!0,e.center=t.id}function T(e,t){return e.cards.filter((function(e){return e.owner===t&&e.location===r.Win})).length}function F(e,t){var a=e.cards.find((function(e){return e.location===r.Deck}));a&&(a.pos=e.positions.players[t],a.location=r.Hand,a.owner=t,a.visible=e.players[t].strategy.isHuman(),a.animating=!0)}function H(e,t,a){t.pos=e.positions.win,t.location=r.Win,t.owner=a,t.visible=!1}!function(e){e.LoadGame="LoadGame",e.StartGame="StartGame",e.PauseGame="PauseGame",e.ResumeGame="ResumeGame",e.Resize="Resize",e.Deal="Deal",e.StartRound="StartRound",e.PlayCard="PlayCard",e.DiscardCard="DiscardCard",e.Draw="Draw",e.Think="Think",e.WinRound="WinRound",e.WinGame="WinGame",e.FinishAnimation="FinishAnimation"}(C||(C={}));var E=function(e){return e.cards.filter((function(t){return t.id===e.center}))[0]},z=function(e,t){return e.cards.filter((function(e){return e.owner===t&&e.location===r.Hand}))},A=function(e){if(e.turn.phase===n.Postgame)return e.players.map((function(t){return{seat:t.seat,handSize:z(e,t.seat).length,wins:T(e,t.seat)}})).filter((function(e){return 3===e.wins})).map((function(e){return e.seat})).shift()},I=function(){var e=Object(h.a)(R,G),t=Object(p.a)(e,2),a=t[0],r=t[1],i=S();return Object(c.useEffect)((function(){var e=window.localStorage.getItem("gameData");null!==e&&a===G&&r({type:C.LoadGame,payload:JSON.parse(e,(function(e,t){return"strategy"===e?"HumanStrategy"===t?new v:new D:t}))}),a!==G&&window.localStorage.setItem("gameData",JSON.stringify(a,(function(e,t){return"strategy"===e?void 0===t.timeout?"HumanStrategy":"BotStrategy":t})))}),[a]),Object(c.useEffect)((function(){if(!(a===G||a.paused||[n.Pregame,n.Preround,n.Postgame].includes(a.turn.phase)||function(e){return e.cards.filter((function(e){return!0===e.animating})).length>0}(a))){var e=function(e){if(e.turn.phase!==n.Preround)return e.players.map((function(t){return{seat:t.seat,handSize:z(e,t.seat).length}})).filter((function(e){return 0===e.handSize})).map((function(e){return e.seat})).shift()}(a);if("undefined"===typeof e){var t=E(a),c=!1;t&&t.visible&&t.id!==a.previousCenter&&(c=!0),a.players.forEach((function(e){(a.turn.player===e.seat||c)&&e.strategy.onCardPlayed(e,a,r)})),a.players.forEach((function(e){return e.strategy.onDiscardNeeded(e,a,r)}))}else{a.players.forEach((function(e){return e.strategy.cancelThoughts()}));var i=A(a);r("undefined"!==typeof i?{type:C.WinGame,payload:{player:i}}:{type:C.WinRound,payload:{player:e}})}}}),[a]),Object(c.useEffect)((function(){r({type:C.Resize,payload:i})}),[i]),{state:a,dispatch:r,positions:i}},B=(a(24),a(1)),L=function(e){var t=e.index,a=e.id,r=e.color,i=e.wallpaper,s=e.decoration,o=e.visible,l=e.location,u=e.pos,d=e.owner,p=e.dispatch,h=e.turn,y=e.animating;Object(c.useEffect)((function(){!0===y&&setTimeout((function(){return p({type:C.FinishAnimation,payload:{id:a}})}),1e3)}),[a,y,l]);var f=o?"".concat(r,"_").concat(i,"_").concat(s):"cardback",m={top:"".concat(u.y,"px"),left:"".concat(u.x,"px"),zIndex:t};return Object(B.jsx)("div",{id:"card".concat(a),className:"card ".concat(f," ").concat(o?"front":"back"," ").concat(l," ").concat(d?"p".concat(d):""),style:m,onClick:function(){0===d&&(0===h.player&&h.phase===n.Play||0!==h.player&&[n.Think,n.Play].includes(h.phase)?p({type:C.PlayCard,payload:{id:a,player:0}}):0===h.player&&h.phase===n.Discard&&p({type:C.DiscardCard,payload:{id:a,player:0}}))}})},M=(a(26),a.p+"static/media/title.66c1b04b.png"),J=a.p+"static/media/rules-matching.f4f1f52e.png",_=a.p+"static/media/rules-discards.41b08232.png",Y=a.p+"static/media/rules-perfect-match.23d58ce4.png",K=function(e){var t=e.dispatch,a=e.resume,n=Object(c.useState)(0),r=Object(p.a)(n,2),i=r[0],s=r[1],o=Object(B.jsx)(c.Fragment,{});switch(i){case 0:o=Object(B.jsxs)(c.Fragment,{children:[Object(B.jsx)("p",{children:"Compete with your fellow interior designers to suggest ideas for how this nook should look."}),Object(B.jsx)("img",{src:M,alt:"Nook title"})]});break;case 1:o=Object(B.jsxs)(c.Fragment,{children:[Object(B.jsx)("p",{children:"Play cards from your hand to create matches with the card in the center."}),Object(B.jsx)("img",{src:J,alt:"Rules on matching"})]});break;case 2:o=Object(B.jsxs)(c.Fragment,{children:[Object(B.jsx)("p",{children:"The better the match, the more cards you can discard. Discard your hand first to win the round."}),Object(B.jsx)("img",{src:_,alt:"Rules on discarding"})]});break;case 3:o=Object(B.jsxs)(c.Fragment,{children:[Object(B.jsx)("p",{children:"You can also play a perfect match at any time \u2014 even when it's not your turn."}),Object(B.jsx)("img",{src:Y,alt:"Rules on perfect matches"})]});break;case 4:o=Object(B.jsx)(c.Fragment,{children:Object(B.jsx)("p",{children:"Be the first designer to empty your hand and you'll win the round! Win 3 rounds and you'll win the game. Good Luck!"})})}return Object(B.jsxs)("div",{className:"rules",children:[Object(B.jsx)("h1",{children:"nook"}),Object(B.jsxs)("div",{className:"instructions-box",children:[o,Object(B.jsxs)("div",{className:"instruction-page-buttons",children:[Object(B.jsx)("button",{onClick:function(){return s(i-1)},disabled:0===i,children:"\u2190"}),Object(B.jsx)("button",{onClick:function(){return s(i+1)},disabled:4===i,children:"\u2192"})]})]}),Object(B.jsxs)("button",{className:4===i?"highlight":"",onClick:function(){t(a?{type:C.ResumeGame,payload:null}:{type:C.StartGame,payload:{numHumans:1,numBots:3}})},children:[a?"Resume":"Start"," Game"]})]})},Q=(a(27),function(e){var t=e.players,a=e.turn,r=e.dispatch,i=e.positions,s={top:"".concat(i.center.y+300,"px"),left:"".concat(i.center.x-150,"px")};return Object(B.jsxs)("div",{className:"turn-tracker ".concat(a.phase),style:s,children:[a.phase===n.Preround?Object(B.jsx)("button",{onClick:function(){return r({type:C.Deal,payload:null})},children:"Deal"}):Object(B.jsx)(c.Fragment,{}),a.phase===n.Wait?Object(B.jsx)("button",{onClick:function(){return r({type:C.StartRound,payload:null})},children:"Ready?"}):Object(B.jsx)(c.Fragment,{}),[n.Play,n.Discard,n.Think].includes(a.phase)?Object(B.jsxs)(c.Fragment,{children:[Object(B.jsxs)("span",{children:[0===a.player?"Your":"".concat(t[a.player].name,"'s")," Turn"]}),Object(B.jsxs)("span",{children:["(",0===a.player?"".concat(a.phase," ").concat(t[a.player].toDiscard>0?"".concat(t[a.player].toDiscard," "):"a ","card").concat(t[a.player].toDiscard>1?"s":""):"".concat(a.phase,"ing..."),")"]})]}):Object(B.jsx)(c.Fragment,{})]})}),U=(a(28),function(e){var t=e.cards,a=e.players,i=e.turn,s=e.seat,o=e.positions;if([n.Pregame].includes(i.phase))return Object(B.jsx)(c.Fragment,{});var l=t.filter((function(e){return e.owner===s&&e.location===r.Hand})).length,u=t.filter((function(e){return e.owner===s&&e.location===r.Win})).length,d=t.filter((function(e){return e.location===r.Deck})).length!==t.length,p=i.player-1;-1===p&&(p=a.length-1);var h=Object(B.jsx)(c.Fragment,{});i.player===s&&i.phase===n.Think?h=Object(B.jsx)("span",{className:"icon",children:"\ud83e\udd14"}):i.phase===n.Preround&&d&&0!==s&&(h=p===s?Object(B.jsx)("span",{className:"icon",children:"\ud83d\ude01"}):Object(B.jsx)("span",{className:"icon",children:"\ud83d\ude12"}));var y={top:"".concat(o.players[s].y+200,"px"),left:"".concat(o.players[s].x-100,"px")};return Object(B.jsxs)("div",{className:"hand-stats ".concat(i.player===s?"highlight":""),style:y,children:[Object(B.jsx)("span",{className:"bold",children:a[s].name}),Object(B.jsxs)("span",{children:["Hand: ",l]}),Object(B.jsxs)("span",{children:["Wins: ",u]}),h]})}),V=(a(29),function(e){var t=e.dispatch,a=e.paused;return Object(B.jsxs)(c.Fragment,{children:[a&&Object(B.jsx)(K,{dispatch:t,resume:!0}),Object(B.jsx)("button",{className:"help-button",onClick:function(){t(a?{type:C.ResumeGame,payload:null}:{type:C.PauseGame,payload:null})},children:"\u2048"})]})}),q=function(e){var t=e.turn,a=e.dispatch,r=e.pos,i={position:"relative",top:"".concat(r.y+210,"px"),left:"".concat(r.x,"px")};return 0===t.player&&t.phase===n.Play?Object(B.jsx)("button",{style:i,onClick:function(){return a({type:C.Draw,payload:{player:0}})},children:"Draw"}):Object(B.jsx)(c.Fragment,{})},X=(a(30),function(e){var t=e.state,a=e.dispatch,n=A(t)||0;return Object(B.jsxs)("div",{className:"offboarding",children:[Object(B.jsxs)("h1",{children:[t.players[n].name," win",0===n?"":"s","!"]}),Object(B.jsx)("p",{children:"Thanks for playing nook!"}),Object(B.jsxs)("p",{children:["Please fill out this\xa0",Object(B.jsx)("a",{href:"https://docs.google.com/forms/d/e/1FAIpQLSfelrfR0elf49pKwpVmCrPzMz5f5rcwJd3TKnu13Rfc4Ajm_w/viewform?usp=sf_link",target:"_blank",rel:"noopener noreferrer",children:"survey"}),"\xa0with your thoughts on the game. I really appreciate it!"]}),Object(B.jsx)("p",{children:Object(B.jsx)("button",{onClick:function(){return a({type:C.StartGame,payload:{numHumans:1,numBots:3}})},children:"Play Again?"})})]})});a(31);var Z=function(){var e=I(),t=e.state,a=e.dispatch,r=e.positions,i=Object(c.useMemo)((function(){return t.cards.map((function(e){return{c:e,sort:d(e.location)+(e.owner?e.owner:0)}}))}),[t.cards]);return t.turn.phase===n.Pregame?Object(B.jsx)(K,{dispatch:a,resume:!1}):t.turn.phase===n.Postgame?Object(B.jsx)(X,{state:t,dispatch:a}):Object(B.jsxs)("div",{className:"App",children:[!t.paused&&Object(B.jsxs)(c.Fragment,{children:[Object(B.jsx)(Q,Object(u.a)(Object(u.a)({},t),{},{dispatch:a})),t.players.map((function(e,a){return Object(B.jsx)(U,Object(u.a)(Object(u.a)({},t),{},{seat:e.seat}),"hand-".concat(a))})),i.map((function(e){var n=e.c,r=e.sort;return Object(B.jsx)(L,Object(u.a)(Object(u.a)({},n),{},{index:t.center===n.id?200:t.previousCenter===n.id?100:r,dispatch:a,turn:t.turn}),n.id)})),Object(B.jsx)(q,Object(u.a)(Object(u.a)({},t),{},{dispatch:a,pos:r.deck}))]}),Object(B.jsx)(V,{dispatch:a,paused:t.paused})]})};a(32),a(33);o.a.render(Object(B.jsxs)(i.a.StrictMode,{children:[Object(B.jsx)(l.a,{position:"top-center",autoClose:3e3,hideProgressBar:!0,newestOnTop:!1,closeOnClick:!1,closeButton:!1,rtl:!1,pauseOnFocusLoss:!1,draggable:!1,pauseOnHover:!1,className:"toaster",toastClassName:"info"}),Object(B.jsx)(Z,{})]}),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.360901f4.chunk.js.map